(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{324:function(e,s,n){"use strict";n.r(s);var t=n(0),a=Object(t.a)({},function(){var e=this,s=e.$createElement,n=e._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h2",{attrs:{id:"前言"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前言","aria-hidden":"true"}},[e._v("#")]),e._v(" 前言")]),e._v(" "),n("p",[e._v("最近由于公司变动业务变动，我开始进行 flutter 业务开发。flutter 是最近两年新起的技术，最重要的功能是跨端开发，能够整合 Android 和 iOS，一端两用，最近连 web 也开始支持编译了。由于之前的业务都是通过 iOS 和 Android 开发的，目前我们公司的 flutter 内容也都是通过插件的方式放在 iOS 和 Android 里面，最近就开始处理一个业务，能够拖动列表进行内容排序，使用了 ReorderableListView 这个 Widget，下面我介绍一下这个 Widget 的使用及我使用此组件遇到的问题。")]),e._v(" "),n("h2",{attrs:{id:"使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用","aria-hidden":"true"}},[e._v("#")]),e._v(" 使用")]),e._v(" "),n("p",[e._v("先简单介绍一下 ReorderableListView 类的属性，官方介绍点"),n("a",{attrs:{href:"https://api.flutter.dev/flutter/material/ReorderableListView-class.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("这里"),n("OutboundLink")],1),e._v("。")]),e._v(" "),n("h3",{attrs:{id:"constructors"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#constructors","aria-hidden":"true"}},[e._v("#")]),e._v(" Constructors")]),e._v(" "),n("blockquote",[n("p",[e._v("ReorderableListView({Widget header, @required List"),n("Widget",[e._v(" children, @required ReorderCallback onReorder, Axis scrollDirection: Axis.vertical, EdgeInsets padding, bool reverse: false })")])],1)]),e._v(" "),n("h3",{attrs:{id:"属性"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#属性","aria-hidden":"true"}},[e._v("#")]),e._v(" 属性")]),e._v(" "),n("ul",[n("li",[e._v("children -> List"),n("Widget",[e._v(": 用于插入一些能够拖动 Widget 列表内容")])],1),e._v(" "),n("li",[e._v("header -> Widget: 用于定义列表项头部的部分，主要用来提示列表项的内容")]),e._v(" "),n("li",[e._v("onReorder -> ReorderCallback(oldIndex,newIndex): 当列表被拖动时执行的回调，有两个参数一个 oldIndex 表示拖动的 Widget 开始的位置，newIndex 表示拖动模块新的位置")]),e._v(" "),n("li",[e._v("padding->EdgeInsets: 设置内边距")]),e._v(" "),n("li",[e._v("scrollDirection->Axis:设置列表滚动的轴")]),e._v(" "),n("li",[e._v("reverse ->bool: 设置滚动列表是否沿读取方向滚动")]),e._v(" "),n("li",[e._v("key->Key")])]),e._v(" "),n("h3",{attrs:{id:"示例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#示例","aria-hidden":"true"}},[e._v("#")]),e._v(" 示例")]),e._v(" "),n("p",[e._v("由于公司项目已经做了内容，我也懒得自己写例子了，使用公司项目中的列表，手写简化出来做示例,代码稍微修改下即可运行。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("List list;//展示的列表,应该定义在类里面，这里只是\n@override\nvoid initState(){\n初始化\n  list=[];\n  for(var i=0;i<10;i++){\n      list.add(i);\n  }\n}\n@override\nWidget build() {\n\n  reutrn ReorderableListView(\n    header: Container(\n      alignment: Alignment(-0.9, 0),\n      height: 45,\n      padding: EdgeInsets.only(top: 15),\n      child: Text('例子'),\n    ),\n   children: list.map((item) {\n      return Container(\n          key: Key(item.toString()),\n          height: 45,\n          width: double.infinity,\n          margin: EdgeInsets.only(top: 5),\n          color: Colors.white,\n          child: Text(item.toString()));\n    }).toList(),\n    onReorder: (int oldIndex, int newIndex) {\n      setState(() {\n        //交换数据\n        if (newIndex > oldIndex) {\n          newIndex -= 1;\n        }\n        final int item = list.removeAt(oldIndex);\n        list.insert(newIndex, item);\n      });\n    },\n    );\n  }\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br"),n("span",{staticClass:"line-number"},[e._v("17")]),n("br"),n("span",{staticClass:"line-number"},[e._v("18")]),n("br"),n("span",{staticClass:"line-number"},[e._v("19")]),n("br"),n("span",{staticClass:"line-number"},[e._v("20")]),n("br"),n("span",{staticClass:"line-number"},[e._v("21")]),n("br"),n("span",{staticClass:"line-number"},[e._v("22")]),n("br"),n("span",{staticClass:"line-number"},[e._v("23")]),n("br"),n("span",{staticClass:"line-number"},[e._v("24")]),n("br"),n("span",{staticClass:"line-number"},[e._v("25")]),n("br"),n("span",{staticClass:"line-number"},[e._v("26")]),n("br"),n("span",{staticClass:"line-number"},[e._v("27")]),n("br"),n("span",{staticClass:"line-number"},[e._v("28")]),n("br"),n("span",{staticClass:"line-number"},[e._v("29")]),n("br"),n("span",{staticClass:"line-number"},[e._v("30")]),n("br"),n("span",{staticClass:"line-number"},[e._v("31")]),n("br"),n("span",{staticClass:"line-number"},[e._v("32")]),n("br"),n("span",{staticClass:"line-number"},[e._v("33")]),n("br"),n("span",{staticClass:"line-number"},[e._v("34")]),n("br"),n("span",{staticClass:"line-number"},[e._v("35")]),n("br"),n("span",{staticClass:"line-number"},[e._v("36")]),n("br"),n("span",{staticClass:"line-number"},[e._v("37")]),n("br"),n("span",{staticClass:"line-number"},[e._v("38")]),n("br"),n("span",{staticClass:"line-number"},[e._v("39")]),n("br"),n("span",{staticClass:"line-number"},[e._v("40")]),n("br")])]),n("p",[e._v("写出来大概的效果如下：")]),e._v(" "),n("p",[n("img",{attrs:{src:"https://blog-1253495453.cos.ap-chongqing.myqcloud.com/flutter%E6%BB%9A%E5%8A%A8.gif",alt:"效果图"}})]),e._v(" "),n("p",[e._v("使用起来非常简单，部分属性都有初始化，只需要简单定义 children 和 onReorder 属性即可完成最简单的拖动列表。")]),e._v(" "),n("h3",{attrs:{id:"解决拖动上滑出现大量空白问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#解决拖动上滑出现大量空白问题","aria-hidden":"true"}},[e._v("#")]),e._v(" 解决拖动上滑出现大量空白问题")]),e._v(" "),n("p",[e._v("问题重现：")]),e._v(" "),n("p",[n("img",{attrs:{src:"https://blog-1253495453.cos.ap-chongqing.myqcloud.com/flutter%E6%BB%91%E5%8A%A8%E9%97%AE%E9%A2%98.gif",alt:"滑动问题"}})]),e._v(" "),n("p",[e._v("此问题只有在特定的情况下出现，我的出现情况是在设置了此 Widget 外套用了 ConstrainedBox 设置来设置其高度，而我把这个问题拿来写是因为我查询了几天资料都没有找到问题的解决方案，在 flutter issue 中也没有找到真正的解决方式，所以写出来希望能帮到正好遇到此问题的朋友。")]),e._v(" "),n("p",[e._v("要解决这个问题，我们就需要从\nReorderableListView 这个类下手了,ReorderableListView 类本质也是一个通过其它封装的 Widget 一起重组的一个组件，就像我们自己写的一个组件一样，如果业务需要，我们要不就只有自己去封装，要不就只有找到原组件问题，去改造成适应自己的业务。如果说改源码会有顾虑，你可以把这个当做自己为了适应需求而写的组件。")]),e._v(" "),n("p",[e._v("查看 reorderable_list.dart 文件第 184 行：")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v(" // This value is used when the extents haven't yet been calculated from\n // the currently dragging widget, such as when it first builds.\n static const double _defaultDropAreaExtent = 100.0;\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br")])]),n("p",[e._v("修改为")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("static const double _defaultDropAreaExtent = 5.0;\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br")])]),n("p",[e._v("设置成 5 是因为还需要留一点空隙去让最后一个元素能够拖动，不然最后其它元素都不能拖动到最后一个元素后面。")]),e._v(" "),n("p",[e._v("然后再修改第 368 行")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("// Drops toWrap into the last position it was hovering over.\n    void onDragEnded() {\n+      reorder(_dragStartIndex, _currentIndex);\n+      _scrollController.animateTo(\n+        0,\n+        duration: _scrollAnimationDuration,\n+        curve: Curves.easeInOut,\n+      );\n    }\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br")])]),n("p",[e._v("目的是为了让每次拖动完成后能回到最初始的位置。好了，大致修改完成。")]),e._v(" "),n("p",[e._v("如果你们有正好遇到此问题的朋友还有更好的解决方案，希望告知。")])])},[],!1,null,null,null);s.default=a.exports}}]);