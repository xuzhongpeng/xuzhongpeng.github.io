(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{322:function(s,e,a){"use strict";a.r(e);var t=a(0),n=Object(t.a)({},function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"flutter引擎编译与调试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#flutter引擎编译与调试","aria-hidden":"true"}},[s._v("#")]),s._v(" Flutter引擎编译与调试")]),s._v(" "),a("h2",{attrs:{id:"前提"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前提","aria-hidden":"true"}},[s._v("#")]),s._v(" 前提")]),s._v(" "),a("ol",[a("li",[s._v("Mac可以编译Android、iOS产物,Linux可以编译Android产物，windows都不能编译（本篇以Mac编译，记录都是以此为前提）")]),s._v(" "),a("li",[s._v("git工具")]),s._v(" "),a("li",[s._v("Chromium "),a("a",{attrs:{href:"http://commondatastorage.googleapis.com/chrome-infra-docs/flat/depot_tools/docs/html/depot_tools_tutorial.html#_setting_up",target:"_blank",rel:"noopener noreferrer"}},[a("code",[s._v("depot_tools")]),a("OutboundLink")],1)])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("安装方式: \n1. 选择一个目录例如 /Users/xxx/\ngit clone https://chromium.googlesource.com/chromium/tools/depot_tools.git\n2. \nexport PATH=/Users/xxx/depot_tools:$PATH\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("ol",{attrs:{start:"4"}},[a("li",[s._v("python环境")]),s._v(" "),a("li",[s._v("curl和unzip工具")]),s._v(" "),a("li",[s._v("xcode")])]),s._v(" "),a("h2",{attrs:{id:"下载源码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#下载源码","aria-hidden":"true"}},[s._v("#")]),s._v(" 下载源码")]),s._v(" "),a("ol",[a("li",[s._v("创建一个文件夹，命名为"),a("code",[s._v("engine")])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("cd engine\ntouch .gclient\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("在"),a("code",[s._v(".gclient")]),s._v("中填入")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('solutions = [\n  {\n    "managed": False,\n    "name": "src/flutter",\n    "url": "git@github.com:flutter/engine.git",\n    "custom_deps": {},\n    "deps_file": "DEPS",\n    "safesync_url": "",\n  },\n]\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("如果你fork了flutter/engine项目，上面的"),a("code",[s._v("git@github.com:flutter/engine.git")]),s._v("可以改为"),a("code",[s._v("git@github.com:你的github名字/engine.git")]),s._v("。\n3. 执行"),a("code",[s._v("gclient sync")])]),s._v(" "),a("p",[s._v("执行这一步，国内很多用户会很慢，所以建议先下从"),a("code",[s._v("https://github.com/flutter/engine")]),s._v("下载好项目，然后把内容（不包括名称）复制到"),a("code",[s._v("src/flutter")]),s._v("下面，再执行"),a("code",[s._v("gclient sync")])]),s._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[s._v("Android Java JDK，版本要1.8及以上")])]),s._v(" "),a("h2",{attrs:{id:"编译android"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编译android","aria-hidden":"true"}},[s._v("#")]),s._v(" 编译Android")]),s._v(" "),a("p",[s._v("目的：编译一个arm64版本的Android产物，可用于最简单的demo跑起来")]),s._v(" "),a("h3",{attrs:{id:"准备构建文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#准备构建文件","aria-hidden":"true"}},[s._v("#")]),s._v(" 准备构建文件")]),s._v(" "),a("ol",[a("li",[s._v("在engine/src目录下执行")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("./flutter/tools/gn --android --unoptimized --android-cpu"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("arm64\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("android：表示编译Android版本")]),s._v(" "),a("li",[s._v("unoptimized： 表示不优化产物大小，这样会提高编译速度")]),s._v(" "),a("li",[s._v("android-cpu： 表示打包的Android架构\n如想编译macos的")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("./flutter/tools/gn --unoptimized --mac --mac-cpu=x64 -j 16\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("编译主机端可执行文件")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("./flutter/tools/gn --unoptimized -j 16\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("这两步会在"),a("code",[s._v("out")]),s._v("文件夹中生成"),a("code",[s._v("android_debug_unopt_arm64")]),s._v("和"),a("code",[s._v("host_debug_unopt")])]),s._v(" "),a("h3",{attrs:{id:"编译产物"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编译产物","aria-hidden":"true"}},[s._v("#")]),s._v(" 编译产物")]),s._v(" "),a("p",[s._v("在"),a("code",[s._v("engine/src")]),s._v("下执行")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("ninja -C out/android_debug_unopt_arm64\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("和")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("ninja -C out/host_debug_unopt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("这两步才是真正构建过程，过程会花点时间。")]),s._v(" "),a("h2",{attrs:{id:"使用本地引擎运行flutter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用本地引擎运行flutter","aria-hidden":"true"}},[s._v("#")]),s._v(" 使用本地引擎运行Flutter")]),s._v(" "),a("ol",[a("li",[s._v("修改"),a("code",[s._v("pubspec.yaml")]),s._v("文件\n在文件中添加下面代码")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dependency_overrides")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("sky_engine")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" <FLUTTER_ENGINE_ROOT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("/engine/src/out/host_debug_unopt/gen/dart"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pkg/sky_engine\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#sky_services:")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  path: <FLUTTER_ENGINE_ROOT>/engine/src/out/host_debug_unopt/gen/dart-pkg/sky_services")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("20220524注：sky_services在flutter2.4版本后被删除")]),s._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[s._v("执行命令")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("flutter run --local-engine-src-path "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("FLUTTER_ENGINE_ROOT"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/engine/src --local-engine"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("android_debug_unopt_arm64\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("local-engine-src-path：指定Flutter引擎存储库的路径，也就是src根目录的绝对路径")]),s._v(" "),a("li",[s._v("local-engine：指定使用哪个引擎版本，比如"),a("code",[s._v("android_debug_unopt_arm64")])])]),s._v(" "),a("h2",{attrs:{id:"使用vscode调试c-引擎代码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用vscode调试c-引擎代码","aria-hidden":"true"}},[s._v("#")]),s._v(" 使用vscode调试c++引擎代码")]),s._v(" "),a("p",[s._v("安装"),a("a",{attrs:{href:"https://mirrors.tencent.com/AndroidSDK/",target:"_blank",rel:"noopener noreferrer"}},[s._v("lldb"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("通过下面shell找到Android项目运行的pid")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("adb shell ps|grep com.example.xxx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("com.example.xxx 表示安装的引用包")])]),s._v(" "),a("div",{staticClass:"language-jsonc line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('{\n  "version": "0.2.0",\n  "configurations": [\n      {\n          "name": "remote_lldb",\n          "type": "lldb",\n          "request": "attach",\n          "pid": "输入pid", // 输入pid\n          "initCommands": [\n              "platform select remote-android",\n              "platform connect unix-abstract-connect:///data/data/包名/debug.socket" // 输入包名\n          ],\n          "preRunCommands": [\n              "settings append target.exec-search-paths xxx/engine/src/out/android_debug_unopt_arm64"  // 替换引擎地址\n          ],\n          "postRunCommands": [\n              "settings set target.source-map xxx/engine/src xxx/engine/src" // 替换引擎地址\n          ],\n      }\n  ]\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("ul",[a("li",[s._v("输入上面获取到的pid")]),s._v(" "),a("li",[s._v("将包名替换上面的"),a("code",[s._v("包名")])]),s._v(" "),a("li",[s._v("将打包后的引擎替换上面的地址")]),s._v(" "),a("li",[s._v("将打包后的引擎地址替换上面的 "),a("code",[s._v("xxx/engine/src")]),s._v(",注意是要输入两次")])]),s._v(" "),a("p",[s._v("F5启动VSCode，开始断点吧")])])},[],!1,null,null,null);e.default=n.exports}}]);