(window.webpackJsonp=window.webpackJsonp||[]).push([[52],{334:function(s,n,e){"use strict";e.r(n);var a=e(0),t=Object(a.a)({},function(){var s=this,n=s.$createElement,e=s._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"前言"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#前言","aria-hidden":"true"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),e("p",[s._v("对于前端来说，webpack当前的使用频率是非常频繁的，下面我们来探讨一下使用webpack引入三方轮子的几种方式以及其中可能出现的坑。")]),s._v(" "),e("h2",{attrs:{id:"方式一-在入口全局引入"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#方式一-在入口全局引入","aria-hidden":"true"}},[s._v("#")]),s._v(" 方式一 在入口全局引入")]),s._v(" "),e("p",[s._v("在入口全局引入在当前来说是最常见的方式，例如vue项目中引入vue包")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("import Vue from 'vue'\n new Vue({\n  el: '#app',\n  components: { App },\n  template: '<App/>'\n})\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),s._v(" "),e("p",[s._v("这种引入方式是直接引入"),e("em",[s._v("node_modules/vue/package.json")]),s._v("中"),e("em",[s._v("main")]),s._v("对应的的位置，例如")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('"main": "dist/vue.runtime.common.js",\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("这就是引入"),e("em",[s._v("node_modules/vue/dist/vue.runtime.common.js")]),s._v("\n如果我们需要修改指向，例如vue包的默认指向的文件vue.runtime.common.js在webpack项目中不能生效，我们可以直接指向该路径")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("import Vue from 'vue/dist/vue.esm.js'\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("在webpack配置中修改别名来修改引入文件的位置,在webpack.config.js文件中")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('resolve:{\n     alias:{\n          // 修改 vue 被导入时的路径    $ 表示以 vue 结尾\n          "vue$":"vue/dist/vue.esm.js"\n          // 给根目录下的 src 目录配置别名。方便引入文件\n          // 注意：在模板组件中的 <style>引入样式 需要加 ~ 波浪线\n          // 如：import \'~@css/style.css\'\n          "@": resolve("src")\n     }\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("p",[s._v("如果你没有做任何优化，这种方式会把引入的vue包和业务代码一起打包到entry的入口文件，这当然不是我们想要的。我们可以用webpack配置来优化让从node_modules中引入的包单独打包成一个文件。")]),s._v(" "),e("h3",{attrs:{id:"使用webpack插件commonschunkplugin优化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用webpack插件commonschunkplugin优化","aria-hidden":"true"}},[s._v("#")]),s._v(" 使用webpack插件CommonsChunkPlugin优化")]),s._v(" "),e("p",[s._v("CommonsChunkPlugin主要是用来提取第三方库和公共模块，避免首屏加载的bundle文件或者按需加载的bundle文件体积过大，从而导致加载时间过长，着实是优化的一把利器。\n在webpack4+中，此插件被移除，取而代之的是optimization。下面是简单的例子")]),s._v(" "),e("p",[s._v("webpack3+")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("//业务代码与node_modules分离\n...\nnew webpack.optimize.CommonsChunkPlugin({    \n  name: 'vendor',\n  minChunks: ({ resource }) => (\n      resource &&\n      resource.indexOf('node_modules') >= 0 &&\n      resource.match(/\\.js$/)\n  ),\n}),\n...\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("p",[s._v("webpack4+")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('module.exports={\n    ...\n    optimization:{\n        splitChunks: {\n        chunks: "vendor",\n        minSize: 30000,\n        minChunks: 1,\n        maxAsyncRequests: 5,\n        maxInitialRequests: 3,\n        name: true,\n        cacheGroups: {\n            default: {\n                minChunks: 2,\n                priority: -20,\n                reuseExistingChunk: true,\n            },\n            vendors: {\n                test: /[\\\\/]node_modules[\\\\/]/,\n                priority: -10\n            }\n        }\n    }\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br")])]),e("p",[s._v("想了解更多webpack4+的optimization配置请看这里 "),e("a",{attrs:{href:"https://webpack.docschina.org/configuration/optimization/",target:"_blank",rel:"noopener noreferrer"}},[s._v("优化(optimization)"),e("OutboundLink")],1)]),s._v(" "),e("h2",{attrs:{id:"方式二-在entry下与入口文件一同引入"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#方式二-在entry下与入口文件一同引入","aria-hidden":"true"}},[s._v("#")]),s._v(" 方式二 在entry下与入口文件一同引入")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('module.exports={\n    entry: {\n       app: ["vue","./index.js"]\n    },\n    ...\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[s._v("此时，vue内部的文件和index.js文件都会被打包成app.js文件，排除优化情况，"),e("strong",[s._v("这里数组里面的所有文件都会被打包成app.js")])]),s._v(" "),e("p",[s._v("同理可以用上面的优化方式把node_modules代码打包到vendor文件中。")]),s._v(" "),e("p",[s._v("这种方式使用不多，主要用于单页项目中需要全局引入的包例如babel-polyfill，那么我们可以直接在这里引入")]),s._v(" "),e("h2",{attrs:{id:"方式三-使用webpack的chunks"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#方式三-使用webpack的chunks","aria-hidden":"true"}},[s._v("#")]),s._v(" 方式三 使用webpack的chunks")]),s._v(" "),e("p",[s._v("在webpack配置的entry中使用别名来引入包例如")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("module.exports={\n    entry:{\n        polyfill:'@babel-polyfill',\n        app:'./src/index.js'\n    }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[s._v("当我们html-webpack-plugin插件没有指定对应的chunks时，"),e("strong",[s._v("entry中的polyfill和app将会被打包成两个文件")]),s._v("（如这里会被打包成polyfill.js和app.js）引入到html文件中，这其中引入顺序决定着js代码的依赖关系，可通过chunksSortMode进行顺序调整")]),s._v(" "),e("p",[s._v("当然我们还可以通过html-webpack-plugin插件中的chunks属性来决定我们当前页面引入哪一个js文件")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("entry: {\n    polyfill: 'babel-polyfill.js',\n    b: './b.js',\n    a: './a.js',\n    d: './d.js',\n    e: './e.js'\n  },\n...\nplugins:{\n    new HtmlWebpackPlugin({\n      inject: true,\n      filename: 'first-file.html',\n      template: 'template.html',   \n      chunks: ['polyfill','a', 'c']\n    }),\n    ...\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br")])]),e("p",[s._v("当这个first-file.html构建成功后，会在底部插入plyfill.js、a.js、c.js到文件中")])])},[],!1,null,null,null);n.default=t.exports}}]);