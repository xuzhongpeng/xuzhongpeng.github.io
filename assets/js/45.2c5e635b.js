(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{330:function(n,s,a){"use strict";a.r(s);var e=a(0),t=Object(e.a)({},function(){var n=this,s=n.$createElement,a=n._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[a("blockquote",[a("p",[n._v("flutter 版本：v1.12.13+hotfix.9")])]),n._v(" "),a("blockquote",[a("p",[n._v("测试系统 macOS")])]),n._v(" "),a("h2",{attrs:{id:"前言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前言","aria-hidden":"true"}},[n._v("#")]),n._v(" 前言")]),n._v(" "),a("p",[n._v("自从 Flutter1.9.1 稳定版升级到 1.12.13 稳定版后，打包也出现了一些变化，之前使用 fat-aar 后能够把所有的 Flutter 内容全部打包进一个 aar 中，上传到公司 maven 库，Android 开发直接 implementation 对应 aar 就能够使用 Flutter 的相关内容及资源了，升级到 1.12.13 后，Flutter 将与 Flutter 的核心库放到了云上，这会导致 Flutter 使用 fat-aar 打出来的包不可使用 Flutter 相关资源，例如 FlutterEngine。如何在 1.12.13 版本下更好的自动化构建及 Android 更加友好的集成，下面是我的一些思路。")]),n._v(" "),a("h2",{attrs:{id:"flutter-build-aar"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#flutter-build-aar","aria-hidden":"true"}},[n._v("#")]),n._v(" flutter build aar?")]),n._v(" "),a("p",[n._v("升级 1.12.13 后，官方提供了"),a("code",[n._v("flutter build aar")]),n._v("命令来打出 aar 资源，对应的使用方式官方有比较详细的流程，"),a("a",{attrs:{href:"https://flutter.dev/docs/development/add-to-app/android/project-setup",target:"_blank",rel:"noopener noreferrer"}},[n._v("flutter build aar 流程"),a("OutboundLink")],1)]),n._v(" "),a("p",[n._v("官方提供的方案使用"),a("code",[n._v("flutter build aar")]),n._v("打包后，会在 build 文件夹下把各个插件资源分别打入不同的文件夹，每个文件夹都会有对应的 aar 及一些信息，我们可以把这个资源全部上传到 maven，这个时候 maven 库可能是这样\n"),a("img",{attrs:{src:"https://blog-1253495453.cos.ap-chongqing.myqcloud.com/build_android/maven_file_20200526.png",alt:"maven目录截图"}})]),n._v(" "),a("p",[n._v("我也尝试过使用官方打出的 aar 上传到 maven，但这会导致两个问题：")]),n._v(" "),a("ol",[a("li",[n._v("上传多个文件将会非常慢，严重影响打包时间")]),n._v(" "),a("li",[n._v("Android 开发人员下拉 Flutter 相关 aar 也会很慢，而且有很大概率会超时")])]),n._v(" "),a("h2",{attrs:{id:"优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#优化","aria-hidden":"true"}},[n._v("#")]),n._v(" 优化")]),n._v(" "),a("p",[n._v("原理：")]),n._v(" "),a("ol",[a("li",[n._v("通过引入 fat-aar，把除了 flutter 核心模块外的模块打成一个 aar")]),n._v(" "),a("li",[n._v("通过上传 maven 所使用的 pom 文件将 flutter 核心模块写入到 pom 文件中，大概是这个样子")])]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("<dependency>\n  <groupId>io.flutter</groupId>\n  <artifactId>flutter_embedding_release</artifactId>\n  <version>1.0.0-af51afceb8886cc11e25047523c4e0c7e1f5d408</version>\n  <scope>compile</scope>\n</dependency>\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[n._v("Android 客户端此方式引入"),a("code",[n._v("api 'xxx:0.0.1'")]),n._v("(原来没升级前引入方式是"),a("code",[n._v("api 'xxx:0.0.1@aar'")]),n._v("),在"),a("code",[n._v("allprojects.repositories")]),n._v("中添加")])]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("maven {\n    url 'http://download.flutter.io'\n}\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br")])]),a("p",[n._v("及自己 maven 对应的 url")]),n._v(" "),a("h2",{attrs:{id:"脚本开发"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#脚本开发","aria-hidden":"true"}},[n._v("#")]),n._v(" 脚本开发")]),n._v(" "),a("ol",[a("li",[n._v("封装执行 sh 脚本代码,打印执行 sh 命令的信息")])]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("//执行sh脚本\nFuture<int> start(String executable, List<String> arguments,\n    {String workingDirectory,\n    Map<String, String> environment,\n    bool includeParentEnvironment = true,\n    bool runInShell = true,\n    ProcessStartMode mode = ProcessStartMode.normal}) async {\n  Process result = await Process.start(executable, arguments,\n      workingDirectory: workingDirectory,\n      environment: environment,\n      includeParentEnvironment: includeParentEnvironment,\n      runInShell: runInShell,\n      mode: mode);\n  result.stdout.listen((out) {\n    if (isPrint) print(utf8.decode(out));\n  });\n  result.stderr.listen((err) {\n    print(utf8.decode(err));\n  });\n  return result.exitCode;\n}\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[n._v("执行"),a("code",[n._v("upgrade")]),n._v("拉取最新插件信息")])]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("await start('flutter', ['pub', 'upgrade']);\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[n._v("复制及插入 fat-aar 相关代码及文件")])]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("print('复制打包aar相关文件');\n  {\n    File copyFile =\n        File(projectDir + '.android/config/dependencies_gradle_plugin.gradle');\n    copyFile.createSync(recursive: true);\n    copyFile.writeAsStringSync(gradlePlugin);\n  }\n  print('插入fat-aar相关的包');\n  {\n    print('插入文件到.andriod/build.gradle');\n    File file = File(projectDir + '/.android/build.gradle');\n    String buildGradle = file.readAsStringSync();\n    if (!buildGradle.contains('com.kezong:fat-aar')) {\n      buildGradle = buildGradle.replaceAllMapped(\n          RegExp(r\"'com.android.tools.build:gradle\\S+\"), (group) {\n        return group.groups([0])[0] + '\\nclasspath \"com.kezong:fat-aar:1.2.12\"';\n      });\n      file.writeAsStringSync(buildGradle);\n    }\n\n    print('插入文件到.andorid/Flutter/build.gradle');\n    File flutterGradleFile =\n        File(projectDir + '/.android/Flutter/build.gradle');\n    String flutterGradleStr = flutterGradleFile.readAsStringSync();\n    if (!flutterGradleStr.contains('com.kezong.fat-aar')) {\n      flutterGradleStr +=\n          '\\napply plugin: \"com.kezong.fat-aar\"\\napply from: \"../config/dependencies_gradle_plugin.gradle\"';\n      flutterGradleFile.writeAsStringSync(flutterGradleStr);\n    }\n  }\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br"),a("span",{staticClass:"line-number"},[n._v("26")]),a("br"),a("span",{staticClass:"line-number"},[n._v("27")]),a("br"),a("span",{staticClass:"line-number"},[n._v("28")]),a("br"),a("span",{staticClass:"line-number"},[n._v("29")]),a("br"),a("span",{staticClass:"line-number"},[n._v("30")]),a("br")])]),a("p",[n._v("其中 gradlePlugin 是一个 gradle 模板")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("//加载aar的gradle\nString gradlePlugin = \"\"\"\n  dependencies {\n    def flutterProjectRoot = rootProject.projectDir.parentFile.toPath()\n    def plugins = new Properties()\n    def pluginsFile = new File(flutterProjectRoot.toFile(), '.flutter-plugins')\n    if (pluginsFile.exists()) {\n        pluginsFile.withReader('UTF-8') { reader -> plugins.load(reader) }\n    }\n    plugins.each { name, path->\n        File editableAndroidProject = new File(path, 'android' + File.separator + 'build.gradle')\n        println name\n        if (editableAndroidProject.exists()) {\n            embed project(path: \":\\$name\", configuration: 'default')\n        }\n    }\n}\n\"\"\";\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br")])]),a("ol",{attrs:{start:"4"}},[a("li",[n._v("开始打包")])]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("print('开始打包');\n  {\n    int exitCode;\n    print('正在打包...');\n    if (buildMode == 'debug') {\n      exitCode = await start('bash', ['./gradlew', 'assembleProfile'],\n          workingDirectory: '$projectDir/.android');\n    } else if (buildMode == 'release') {\n      exitCode = await start('bash', ['./gradlew', 'assembleRelease'],\n          workingDirectory: '$projectDir/.android');\n    } else {\n      exitCode = await start('bash', ['./gradlew', 'assemble'],\n          workingDirectory: '$projectDir/.android');\n    }\n    if (exitCode != 0) {\n      print('打包出错');\n      return false;\n    } else {\n      print('打包成功');\n    }\n  }\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br")])]),a("p",[n._v("这个时候可以打开"),a("code",[n._v(".android/Flutter/build/outputs/aar/")]),n._v("看到相关的 aar 文件，这里我打 debug 包使用 profile 打包方式，主要原因是我使用的"),a("code",[n._v("com.kezong:fat-aar")]),n._v("插件打出的 debug 包没有把资源打进去，我不清楚这是 bug 还是我使用的方式不对，有人知道可以告诉我一下。")]),n._v(" "),a("ol",{attrs:{start:"5"}},[a("li",[n._v("上传 maven")])]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("print('开始上传maven');\n  {\n    bool result;\n    if (buildMode == 'debug' || buildMode == 'release') {\n      result = await uploadMaven(buildVersion, buildMode);\n      await uploadToWX(buildVersion, buildMode, exitCode == 0);\n      if (!result) {\n        print('上传aar失败');\n        return false;\n      }\n    } else {\n      result = await uploadMaven(buildVersion, 'debug');\n      await uploadToWX(buildVersion, 'debug', exitCode == 0);\n      if (exitCode != 0) {\n        print('上传aar失败');\n        return false;\n      }\n      result = await uploadMaven(buildVersion, 'release');\n      await uploadToWX(buildVersion, 'release', exitCode == 0);\n      if (exitCode != 0) {\n        print('上传aar失败');\n        return false;\n      }\n    }\n  }\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br")])]),a("p",[n._v("其中 uploadMaven 方法是专门用来处理上传 maven 有关的文件及替换版本号等")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("///上传到maven\nFuture<bool> uploadMaven(String version, String buildMode) async {\n  if (mavenUrl == 'xxx') {\n    print('你什么都没改，别传maven了');\n    return false;\n  }\n  String pomName; //pom名\n  String build; //arr对应文件名\n  // final dir = Directory(\"build/host/outputs/repo\");\n  if (buildMode == 'debug') {\n    pomName = 'trojanDebug';\n    build = 'profile';\n  } else {\n    pomName = 'trojan';\n    build = 'release';\n  }\n  final aar =\n      File(\"$projectDir/.android/Flutter/build/outputs/aar/flutter-$build.aar\");\n  final pom1 = File(\"$projectDir/configs/trojan.pom\");\n  final tempPath = File(\"${Directory.systemTemp.path}/temp.pom\");\n  tempPath.createSync(recursive: true);\n  final temp = pom1.copySync(tempPath.path);\n  print('修改pom内容');\n  {\n    final doc = xml.parse(temp.readAsStringSync());\n    {\n      // 修改自身的版本号\n      final xml.XmlText versionNode =\n          doc.findAllElements(\"version\").first.firstChild;\n      versionNode.text = version;\n      final xml.XmlText name =\n          doc.findAllElements(\"artifactId\").first.firstChild;\n      name.text = pomName;\n    }\n    final elements = doc.findAllElements(\"dependency\");\n    // 修改flutter相关依赖名\n    for (final element in elements) {\n      xml.XmlText artifactId =\n          element.findElements(\"artifactId\").first.firstChild;\n      if (artifactId.text.contains('release')) {\n        artifactId.text =\n            artifactId.text.replaceAll('release', build); // 修改依赖的版本号\n        print(artifactId);\n      }\n    }\n    final buffer = StringBuffer();\n    doc.writePrettyTo(buffer, 0, \"  \");\n    temp.writeAsStringSync(buffer.toString());\n  }\n  DeployObject deploy = DeployObject()\n    ..aarFile = aar\n    ..pomFile = temp;\n\n  //把用户名密码写入mvn-setting.xml\n  {\n    File setting = File('$projectDir/configs/mvn-settings.xml');\n    final doc = xml.parse(setting.readAsStringSync());\n    final xml.XmlText user = doc.findAllElements(\"username\").first.firstChild;\n    user.text = username;\n    final xml.XmlText pwd = doc.findAllElements('password').first.firstChild;\n    pwd.text = password;\n    final buffer = StringBuffer();\n    doc.writePrettyTo(buffer, 0, \"  \");\n    setting.writeAsStringSync(buffer.toString());\n  }\n  print('开始上传');\n  {\n    final configPath =\n        File('$projectDir/configs/mvn-settings.xml').absolute.path;\n    List<String> args = [\n      'deploy:deploy-file',\n      '-DpomFile=\"${deploy.pomFile.absolute.path}\"',\n      '-Dmaven.metadata.legacy=true',\n      '-DgeneratePom=false',\n      '-Dfile=\"${deploy.aarFile.absolute.path}\"',\n      '-Durl=\"${mavenUrl}\"',\n      '-DrepositoryId=\"nexus\"',\n      '-Dpackaging=aar',\n      '-s=\"$configPath\"',\n    ];\n    final shell = \"mvn ${args.join(' \\\\\\n    ')}\";\n    final f = File(\n        \"${Directory.systemTemp.path}/${DateTime.now().millisecondsSinceEpoch}.sh\");\n    f.writeAsStringSync(shell);\n    final exitCode = await start('bash', [f.path]);\n    f.deleteSync();\n    if (exitCode != 0) {\n      print(deploy.aarFile.path.split('/').last + '上传失败');\n      return false;\n    } else {\n      print(deploy.aarFile.path.split('/').last + '上传成功');\n    }\n  }\n  temp.deleteSync();\n  return true;\n}\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br"),a("span",{staticClass:"line-number"},[n._v("26")]),a("br"),a("span",{staticClass:"line-number"},[n._v("27")]),a("br"),a("span",{staticClass:"line-number"},[n._v("28")]),a("br"),a("span",{staticClass:"line-number"},[n._v("29")]),a("br"),a("span",{staticClass:"line-number"},[n._v("30")]),a("br"),a("span",{staticClass:"line-number"},[n._v("31")]),a("br"),a("span",{staticClass:"line-number"},[n._v("32")]),a("br"),a("span",{staticClass:"line-number"},[n._v("33")]),a("br"),a("span",{staticClass:"line-number"},[n._v("34")]),a("br"),a("span",{staticClass:"line-number"},[n._v("35")]),a("br"),a("span",{staticClass:"line-number"},[n._v("36")]),a("br"),a("span",{staticClass:"line-number"},[n._v("37")]),a("br"),a("span",{staticClass:"line-number"},[n._v("38")]),a("br"),a("span",{staticClass:"line-number"},[n._v("39")]),a("br"),a("span",{staticClass:"line-number"},[n._v("40")]),a("br"),a("span",{staticClass:"line-number"},[n._v("41")]),a("br"),a("span",{staticClass:"line-number"},[n._v("42")]),a("br"),a("span",{staticClass:"line-number"},[n._v("43")]),a("br"),a("span",{staticClass:"line-number"},[n._v("44")]),a("br"),a("span",{staticClass:"line-number"},[n._v("45")]),a("br"),a("span",{staticClass:"line-number"},[n._v("46")]),a("br"),a("span",{staticClass:"line-number"},[n._v("47")]),a("br"),a("span",{staticClass:"line-number"},[n._v("48")]),a("br"),a("span",{staticClass:"line-number"},[n._v("49")]),a("br"),a("span",{staticClass:"line-number"},[n._v("50")]),a("br"),a("span",{staticClass:"line-number"},[n._v("51")]),a("br"),a("span",{staticClass:"line-number"},[n._v("52")]),a("br"),a("span",{staticClass:"line-number"},[n._v("53")]),a("br"),a("span",{staticClass:"line-number"},[n._v("54")]),a("br"),a("span",{staticClass:"line-number"},[n._v("55")]),a("br"),a("span",{staticClass:"line-number"},[n._v("56")]),a("br"),a("span",{staticClass:"line-number"},[n._v("57")]),a("br"),a("span",{staticClass:"line-number"},[n._v("58")]),a("br"),a("span",{staticClass:"line-number"},[n._v("59")]),a("br"),a("span",{staticClass:"line-number"},[n._v("60")]),a("br"),a("span",{staticClass:"line-number"},[n._v("61")]),a("br"),a("span",{staticClass:"line-number"},[n._v("62")]),a("br"),a("span",{staticClass:"line-number"},[n._v("63")]),a("br"),a("span",{staticClass:"line-number"},[n._v("64")]),a("br"),a("span",{staticClass:"line-number"},[n._v("65")]),a("br"),a("span",{staticClass:"line-number"},[n._v("66")]),a("br"),a("span",{staticClass:"line-number"},[n._v("67")]),a("br"),a("span",{staticClass:"line-number"},[n._v("68")]),a("br"),a("span",{staticClass:"line-number"},[n._v("69")]),a("br"),a("span",{staticClass:"line-number"},[n._v("70")]),a("br"),a("span",{staticClass:"line-number"},[n._v("71")]),a("br"),a("span",{staticClass:"line-number"},[n._v("72")]),a("br"),a("span",{staticClass:"line-number"},[n._v("73")]),a("br"),a("span",{staticClass:"line-number"},[n._v("74")]),a("br"),a("span",{staticClass:"line-number"},[n._v("75")]),a("br"),a("span",{staticClass:"line-number"},[n._v("76")]),a("br"),a("span",{staticClass:"line-number"},[n._v("77")]),a("br"),a("span",{staticClass:"line-number"},[n._v("78")]),a("br"),a("span",{staticClass:"line-number"},[n._v("79")]),a("br"),a("span",{staticClass:"line-number"},[n._v("80")]),a("br"),a("span",{staticClass:"line-number"},[n._v("81")]),a("br"),a("span",{staticClass:"line-number"},[n._v("82")]),a("br"),a("span",{staticClass:"line-number"},[n._v("83")]),a("br"),a("span",{staticClass:"line-number"},[n._v("84")]),a("br"),a("span",{staticClass:"line-number"},[n._v("85")]),a("br"),a("span",{staticClass:"line-number"},[n._v("86")]),a("br"),a("span",{staticClass:"line-number"},[n._v("87")]),a("br"),a("span",{staticClass:"line-number"},[n._v("88")]),a("br"),a("span",{staticClass:"line-number"},[n._v("89")]),a("br"),a("span",{staticClass:"line-number"},[n._v("90")]),a("br"),a("span",{staticClass:"line-number"},[n._v("91")]),a("br"),a("span",{staticClass:"line-number"},[n._v("92")]),a("br"),a("span",{staticClass:"line-number"},[n._v("93")]),a("br"),a("span",{staticClass:"line-number"},[n._v("94")]),a("br"),a("span",{staticClass:"line-number"},[n._v("95")]),a("br"),a("span",{staticClass:"line-number"},[n._v("96")]),a("br")])]),a("p",[n._v("其中的"),a("code",[n._v("build.pom")]),n._v("文件可以点击"),a("a",{attrs:{href:"https://github.com/xuzhongpeng/flutter_build/blob/master/configs/build.pom",target:"_blank",rel:"noopener noreferrer"}},[n._v("这里"),a("OutboundLink")],1),n._v("看到，主要功能是管理 aar 版本号及存放 flutter 相关的库，这里这些库我是执行"),a("code",[n._v("flutter build aar")]),n._v("拿到的，目前我这个版本生成的都是这几个文件。")]),n._v(" "),a("p",[n._v("我是通过 mvn 命令上传到 maven 的，所以需要安装 mvn 命令去"),a("a",{attrs:{href:"http://maven.apache.org/download.cgi",target:"_blank",rel:"noopener noreferrer"}},[n._v("官网"),a("OutboundLink")],1),n._v("安装")]),n._v(" "),a("p",[n._v("最后上传到 maven 仓库后是这样\n"),a("img",{attrs:{src:"https://blog-1253495453.cos.ap-chongqing.myqcloud.com/build_android/maven_version_20200526.png",alt:""}})]),n._v(" "),a("p",[n._v("全部代码请移步"),a("a",{attrs:{href:"https://github.com/xuzhongpeng/flutter_build",target:"_blank",rel:"noopener noreferrer"}},[n._v("flutter_build"),a("OutboundLink")],1)]),n._v(" "),a("h2",{attrs:{id:"目前问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#目前问题","aria-hidden":"true"}},[n._v("#")]),n._v(" 目前问题")]),n._v(" "),a("ol",[a("li",[n._v("我不清楚是否 flutter 的资源名后缀能否自动获取，目前是写死的，比如"),a("code",[n._v("1.0.0-af51afceb8886cc11e25047523c4e0c7e1f5d408")])]),n._v(" "),a("li",[n._v("fat-aar 能否把 flutter 资源下载后打入到一个 aar 中")])]),n._v(" "),a("h2",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结","aria-hidden":"true"}},[n._v("#")]),n._v(" 总结")]),n._v(" "),a("p",[n._v("由于对 gradle 还不是很熟悉，还不清楚是否有更好的打包及集成方式，希望能得到大家提醒，我也能够改进打包脚本")])])},[],!1,null,null,null);s.default=t.exports}}]);